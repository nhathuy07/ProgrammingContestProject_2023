<Btn@MDFillRoundFlatButton>:
    font_name: "UI/Fonts/WorkSans-Bold.ttf"
    font_size: '16sp'
    md_bg_color: (238/255, 249/255, 255/255, 1)
    line_color: (33/255, 150/255, 243/255)

<DocsChooser>:
    canvas.before:
        Color:
            rgba: (0, 0, 0, 0.3)
        Rectangle:
            pos: self.pos
            size: self.size
    MDCard:
        id: _card
        elevation: 2.5
        shadow_softness: 12
        radius: 15

    Btn:
        text: 'Mở file'

<CustomRoundFlatBtn@MDFillRoundFlatButton>:
    font_name: 'UI/Fonts/WorkSans-Regular.ttf'
    font_size: '16sp'
    md_bg_color: 1,1,1,1
    line_color: (33/255, 150/255, 243/255)
    text_color: 56/255, 56/255, 56/255

<Item>
    ImageLeftWidget:
        source: root.source

<MDLabel>:
    font_name: "UI/Fonts/WorkSans-Regular.ttf"

<SubjectCard>:
    orientation: "vertical"
    padding: 13
    line_color: 56/255, 56/255, 56/255
    radius: 20
    size_hint_x: 1
    size_hint_y: 1
    MDCard:
        md_bg_color: root.card_color

        MDLabel:
            id: card_icon
            text: root.card_icon
            font_size: '28sp'
            font_name: "UI/Fonts/seguiemj.ttf"
            halign: "center"
            on_touch_down: True
    
    MDLabel:
        id: card_label
        font_size: '16sp'
        font_name: "UI/Fonts/WorkSans-Regular.ttf"
        text: root.subject_name
        halign: "center"
        on_touch_down: True
        

<KeywordsView>:
    viewclass: 'CustomRoundFlatBtn'
    spacing: 20
    do_scroll_y: False
    size_hint_x: 1
    size_hint_y: 1
    padding: 0, 0, 0,15
    RecycleBoxLayout:

        spacing: 5
        size_hint_y: 1
        size_hint_x: None
        height: self.minimum_height
        width: self.minimum_width


<DaysOfWeekView>:
    viewclass: 'DaysOfWeekBtn'
    spacing: 20
    padding: 5, 5
    do_scroll_y: False
    size_hint_x: 1
    size_hint_y: 1
    padding: 0, 5, 0,5
    RecycleBoxLayout:

        spacing: 5
        size_hint_y: 1
        size_hint_x: None
        height: self.minimum_height
        width: self.minimum_width

<CameraFrame>:
    size_hint_x: 1
    md_bg_color: 0,0,0,1
    MDGridLayout:
        rows: 2
        id: outer_layout
        size_hint_x: 1.0
        BoxLayout:
            id: camera_slot
            size_hint_y: 0.9
        MDGridLayout:
            halign: 'center'
            cols: 3
            id: inner_layout
            size_hint_y: 0.1
            size_hint_x: 1
            spacing: 10
            
            MDFillRoundFlatButton:
                text: 'Flash off'
                font_style: 'Button'
                md_bg_color: 1, 1, 1, 0
                on_release: root.flash()
                id: flash_btn
                halign:'left'

            MDRaisedButton:
                text: '📷'
                font_size: '40dp'
                font_name: 'UI/Fonts/seguiemj.ttf'
                md_bg_color: 1, 1, 1,1
                id: shot_btn
                on_release: root.shot()
                halign: 'center'

            MDFillRoundFlatButton:
                text: 'Hủy'
                font_style: 'Button'
                md_bg_color: 1, 1, 1, 0
                on_release: root.disconnect()
                id: cancel_btn
                halign: 'right'
            

    

# reference: https://www.geeksforgeeks.org/python-recycleview-in-kivy/
<DocsList>:
    viewclass: 'DocsCard'  # defines the viewtype for the data items.
    spacing: 20

    RecycleBoxLayout:
        padding:15,25,20,0
        spacing: 20
        size: self.size
        default_size: dp(230), dp(80)
        # defines the size of the widget in reference to width and height
        default_size_hint: None, None
        size_hint_x: None
        width: self.minimum_width
        orientation: 'horizontal' # defines the orientation of data items

<NeedsImprovementCard>:
    size_hint_x: 3
    theme_text_color: 'Primary'
    tertiary_theme_text_color: 'Custom'
    tertiary_text_color: (148/255, 16/255, 16/255)
    tertiary_font_style: "Button"
    font_style: 'Body1'


<DetailedResultItem>:
    theme_text_color: 'Custom'
    tertiary_theme_text_color: 'Custom'
    text_color: 1, 1, 1, 1
    tertiary_text_color: (175/255, 242/255, 92/255)
    tertiary_font_style: "Button"
    ImageLeftWidget:
        source: root.grade_icon_path

<DetailedResultList>:
    viewclass: 'DetailedResultItem'  # defines the viewtype for the data items.
    spacing: 20
    padding:10, 0
    do_scroll_y: True
    do_scroll_x: True
    RecycleBoxLayout:
        default_size: None, dp(64)
        # defines the size of the widget in reference to width and height
        default_size_hint: 1, None 
        size_hint_y: None
        size_hint_x: 4
        height: self.minimum_height
        width: self.minimum_width
        orientation: 'vertical' # defines the orientation of data items

<SubjectCheckbox>:
    ImageLeftWidget:
        id: check_icon

<SubjectChooserList>:
    viewclass: 'SubjectCheckbox'  # defines the viewtype for the data items.
    spacing: 20
    padding:10, 0
    do_scroll_y: True
    do_scroll_x: True
    RecycleBoxLayout:
        id: recycleLayout
        default_size: None, dp(64)
        # defines the size of the widget in reference to width and height
        default_size_hint: 1, None 
        size_hint_y: None
        size_hint_x: 1
        height: self.minimum_height
        width: self.minimum_width
        orientation: 'vertical' # defines the orientation of data items

<SwappableCard>:
    radius: 10
    padding: 5, 5
    #md_bg_color: root.bgColor
    md_bg_color: root.bgColor
    default_size_hint: 1, 0.2
    size_hint_x: 1
    spacing: 10
    on_release: root.prepare_swap(root.text)
    MDCard:
        radius: 100
        padding: 0, 0
        size_hint: None, 1
        width: root.height * 0.8
        md_bg_color: 0, 0, 0, 0
        MDLabel:
            font_name: "UI/Fonts/WorkSans-Bold.ttf"
            text: u'↕'
            
            halign: 'center'
            valign: 'center'
            font_size: '22sp'
            #color: root.bgColor
            color: 1, 1, 1, 1
    MDLabel:
        id: card_label
        size_hint: 1, 1
        text: root.text[1]
        font_name: "UI/Fonts/WorkSans-Bold.ttf"
        color: 1, 1, 1, 1
        
        font_size: '16sp'


<DocsCard>:

    BoxLayout:
        default_size_hint: 1, 0.6
        # padding: 10,20
        #orientation: 'vertical'

        MDCard:
            on_press: root.on_press()
            radius: 20
            line_color: (56/255, 56/255, 56/255)

            spacing: 0
            BoxLayout:
                padding: 0, 0
                size_hint: None, 1
                width: '60sp'

                MDLabel:
                    halign: "center"
                    font_size: '27sp'
                    text: root.icon
                    font_name: "UI/Fonts/seguiemj.ttf"
            BoxLayout:
                spacing: 6
                orientation: "vertical"
                size_hint: 1, 1
                padding: 0,10,0,10
                MDLabel:
                    color: 0, 0, 0, 1
                    text: root.title
                    font_size: '18sp'
                    color: (56/255, 56/255, 56/255)
                    
                    font_name: 'UI/Fonts/WorkSans-SemiBold.ttf'
                    halign: "left"
                    valign: "center"
                BoxLayout:
                    MDLabel:
                        text: f'{root.theme}'
                        halign: 'left'
                        valign: "center"
                        font_name: 'UI/Fonts/WorkSans-Italic.ttf'
                        color: 100/255, 100/255, 100/255, 1  
                        font_size: '15sp'


<MDTextField>:
    mode: 'round'

<WelcomeScreen>:
    name: "WelcomeScreen"
    theme: ""
    canvas.before:
        Color:
            rgba:255,255,255,1
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        padding: 0, 0
        orientation: 'vertical'

        Image:
            source: os.path.join(app.EXEC_ARGS, "UI/Images/login.png")
            allow_stretch: False
            keep_ratio: True
            size_hint_y:0.6
 


        MDCard:
            elevation: 2.5
            shadow_softness: 12
            padding: 4
            size_hint_y: 0.5
            radius: 30,30,0,0


            BoxLayout:
                orientation: 'vertical'
                padding: 20, 10,20,20
                spacing: 40
                
                BoxLayout:
                    size_hint_y: None
                    orientation: 'vertical'
                    padding: 0,40,0,0
                    spacing: 20
                    MDLabel:
                        color: (56/255, 56/255, 56/255, 1)
                        text: "Chào mừng!"
                        font_size: '30sp'
                        
                        font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                        halign: "left" 

                    MDLabel:
                        color: (56/255, 56/255, 56/255, 1)
                        text: "Hãy đăng nhập để bắt đầu ôn tập"
                        font_size: '16sp'
                        
                        font_name: 'UI/Fonts/WorkSans-Regular.ttf'
                        halign: "left"     
                BoxLayout:
                    spacing: 10 
                    padding: 0, 0, 0, 0
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height
                    MDTextField:
                        id: email
                        hint_text: "Email"
                        padding: 0
                        text: app.get_credential().username

                    MDTextField:
                        id: pw
                        hint_text: "Mật khẩu"
                        password: True
                        padding: 0
                        text: app.get_credential().password
                    
                    Btn:
                        text: 'Đăng nhập'
                        size_hint_x: None
                        width: self.parent.width
                        halign: 'center'
                        padding: 5, 5
                        md_bg_color: (241/255, 226/255, 135/255,1)
                        # md_bg_color: (166/255, 239/255, 255/255)
                        text_color: (56/255, 56/255, 56/255, 1)
                        line_color: (56/255, 56/255, 56/255, 1)
                        on_press: 
                            root.submit(email.text, pw.text)
                    MDTextButton:
                        text: 'Chưa có tài khoản? Đăng kí'
                        halign: 'center'
                        size_hint_x: None
                        width: self.parent.width
                        
                        font_name: 'UI/Fonts/WorkSans-Italic.ttf'
                        on_press: 
                            app.reload_screen(1, "left")
                            
<SignupForm>:
    name: "SignupForm"
    theme: ""
    on_enter:
        self.generate_captcha()
    canvas.before:
        Color:
            rgba:1,1,1,1
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        padding: 0,0
        orientation: 'vertical'
        Image:
            source: os.path.join(app.EXEC_ARGS, "./UI/Images/user-plus.png")
            allow_stretch: True
            keep_ratio: True
            size_hint_y: 0.4
        MDCard:
            elevation: 2.5
            shadow_softness: 12
            padding: 30, 30, 30, 30
            size_hint_y: 0.5
            height: self.minimum_height
            radius: 30,30,0,0
            orientation: 'vertical'

            MDLabel:
                color: (56/255, 56/255, 56/255, 1)
                text: "Đăng kí"
                font_size: '30sp'
                
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                halign: "left"
                size_hint_y: 0.2
                    
            BoxLayout:
                spacing: 10 
                padding: 0, 0, 0, 0
                orientation: 'vertical'
                size_hint_y: 0.8
                MDTextField:
                    hint_text: "Email"
                    id: email_su
                    padding: 0

                MDTextField:
                    hint_text: "Mật khẩu"
                    id: pw_su
                    password: True
                    padding: 0
                MDTextField:
                    hint_text: "Nhắc lại mật khẩu"
                    id: pw_repeat
                    password: True
                    padding: 0
                
                GridLayout:
                    cols: 2
                    MDTextField:
                        id: captcha
                        hint_text: "Mã CAPTCHA"
                        padding: 0
                    Image:
                        id: captcha_img
                        allow_stretch: True
                        source: 'temp.png'
                
                Btn:
                    text: 'Tiếp tục'
                    width: self.parent.width
                    halign: 'center'
                    padding: 5, 5
                    md_bg_color: (108/255, 226/255, 203/255)
                    text_color: (56/255, 56/255, 56/255, 1)
                    line_color: (56/255, 56/255, 56/255, 1)
                    on_press: 
                        if root.signup(email_su.text, pw_su.text, pw_repeat.text, captcha.text) == True: app.reload_screen(2, "right")
                
                MDTextButton:
                    text: 'Đã có tài khoản? Đăng nhập'
                    halign: 'center'
                    width: self.parent.width
                    
                    font_name: 'UI/Fonts/WorkSans-Italic.ttf'
                    on_press:
                        
                        app.reload_screen(0, "right")

<HomePage>:
    name: "HomePage"
    on_enter: 
        root._reload_greetings()
    MDBoxLayout:
        orientation: "vertical" 
        spacing: 20

        # Top bar
        MDBoxLayout:
            padding: 10
            size_hint_y: 0.1
            spacing: 20


            AnchorLayout:
                anchor_x: "left"
                MDCard:
                    shadow_softness: 12
                    elevation: 1.4

                    radius: 23
                    #md_bg_color: (0.573, 0.855, 1.00)
                    
                    size_hint_x: 1
                    size_hint_y: None
                    height: '36dp'
                    line_width: 1.0
                    spacing: 10
                    padding: 0, 0, 10, 0
                    Image:

                        size_hint_x: None
                        width: '32dp'
                        keep_ratio: True
                        allow_stretch: True
                        
                        source: "UI/Images/profile-icon.png"
                    MDLabel:
                        id: greetings
                        text: "0/0"
                        font_name:'UI/Fonts/WorkSans-Bold.ttf'
                        font_size: '20sp'
                        color: (56/255, 56/255, 56/255, 1)

            # progress counter
            AnchorLayout:
                anchor_x: "right"
                MDCard:

                    id: progress_counter_container
                    radius: 23
                    line_color: (56/255, 56/255, 56/255, 1)
                    #md_bg_color: (0.573, 0.855, 1.00)
                    md_bg_color: (148/255, 110/255, 190/255)
                    
                    size_hint_x: 0.5
                    size_hint_y: None
                    height: '36dp'
                    line_width: 1.0
                    spacing: 10
                    padding: 0, 0, 10, 0
                    Image:
                        id: progress_counter_image
                        size_hint_x: None
                        width: '32dp'
                        keep_ratio: True
                        allow_stretch: True
                        
                        source: "UI/Images/target-fill-1.png"
                    MDLabel:
                        id: progress_counter
                        text: "0/0"
                        font_name:'UI/Fonts/WorkSans-Bold.ttf'
                        font_size: '20sp'
                        color: (56/255, 56/255, 56/255, 1)
            
        BoxLayout:
            shadow_softness: 12
            elevation: 1.4
            radius: 15,15
            orientation: "vertical"
            md_bg_color: 1,1,1,0
            spacing: 14
            padding: 15,15
            size_hint_y: 0.9

            # Suggested contents box  
            MDCard:
                id: suggestionbox
                default_size_hint_x: 1
                size_hint_x: 1
                size_hint_y:None
                height: dp(230)
                padding: 5, 5, 5, 20
                spacing: 0
                elevation: 2.1
                shadow_softness: 12
                radius: 25,25
                orientation: 'vertical'

                md_bg_color: (255/255, 246/255, 142/255)
                line_color: 56/255,56/255,56/255

                # Box title                  
                BoxLayout:
                    orientation: 'horizontal'
                    spacing: 10
                    padding: 5,10
                    size_hint_x: 1.0
                    size_hint_y: None

                    # Illustrative icon
                    Image:
                        width: '44sp'
                        keep_ratio: True
                        source: "UI/Images/suggested_icon.png"
                        size_hint_x: None
                    # Label for suggested contents box
                    BoxLayout:
                        orientation: 'vertical'
                        spacing: 10
                        size_hint_x: 1
                        padding: 0,9,0,10

                        size_hint_y: None
                        height: '58dp'
                        MDLabel:
                            id: suggestionbox_title
                            text:  "Gợi ý tự luyện"
                            font_size: '22sp'
                            halign: "left"
                            color: (56/255, 56/255, 56/255, 1)
                            font_name: 'UI/Fonts/WorkSans-Bold.ttf'

                        MDLabel:
                            id: suggestionbox_subtitle
                            text:  "Dựa trên mục tiêu hằng ngày"
                            font_size: '16sp'
                            halign: "left"
                            bold: False
                            color: (56/255, 56/255, 56/255, 1)
                            font_name: 'UI/Fonts/WorkSans-Regular.ttf'
                        
                DocsList:
                    id: docslist

                BoxLayout:
                    padding: 20, 0, 20, 0
                    size_hint_y: 0.55

                    MDFillRoundFlatButton:
                        size_hint: None, None
                        
                        md_bg_color: 1,1,1,0.45
                        text_color: (56/255, 56/255, 56/255, 1)
                        text: '+ Thiết lập mục tiêu...'
                        
                        font_name: 'UI/Fonts/WorkSans-Italic.ttf'
                        halign: 'center'
                        font_size: '14sp'
                        on_press:
                            app.reload_screen(5)

            # subject chooser
            MDCard:
                padding: 0, 15, 0, 0
                size_hint_y: 0.5
                orientation: "vertical"
                spacing: 15

                MDLabel:
                    text:  "Ôn tập theo môn học"
                    font_size: '22sp'
                    halign: "left"
                    color: (56/255, 56/255, 56/255, 1)
                    font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                    size_hint_y: 0.1
                
                # subject grid
                ScrollView:
                    GridLayout:
                        id: subject_chooser
                        cols: 3
                        size_hint_y: 2.5
                        spacing: 10

                        SubjectCard:
                            subject_fullname: "Ngữ văn"
                            subject_name: app.LABELS_BY_SUBJECT[self.subject_fullname][0]
                            card_icon: app.LABELS_BY_SUBJECT[self.subject_fullname][1]
                            on_press: self.load_text_list_by_subject(self.subject_fullname)
                    
                        SubjectCard:
                            subject_fullname: "Ngoại ngữ"
                            subject_name: app.LABELS_BY_SUBJECT[self.subject_fullname][0]
                            card_icon: app.LABELS_BY_SUBJECT[self.subject_fullname][1]
                            on_press: self.load_text_list_by_subject(self.subject_fullname)
                    
                        SubjectCard:
                            subject_fullname: "Giáo dục Quốc phòng an ninh"
                            subject_name: app.LABELS_BY_SUBJECT[self.subject_fullname][0]
                            card_icon: app.LABELS_BY_SUBJECT[self.subject_fullname][1]
                            on_press: self.load_text_list_by_subject(self.subject_fullname)
                    
                        SubjectCard:
                            subject_fullname: "Nội dung Giáo dục Địa phương"
                            subject_name: app.LABELS_BY_SUBJECT[self.subject_fullname][0]
                            card_icon: app.LABELS_BY_SUBJECT[self.subject_fullname][1]
                            on_press: self.load_text_list_by_subject(self.subject_fullname)
                    
                        SubjectCard:
                            subject_fullname: "Hoạt động trải nghiệm, hướng nghiệp"
                            subject_name: app.LABELS_BY_SUBJECT[self.subject_fullname][0]
                            card_icon: app.LABELS_BY_SUBJECT[self.subject_fullname][1]
                            on_press: self.load_text_list_by_subject(self.subject_fullname)
                    
                        SubjectCard:
                            subject_fullname: "Lịch sử"
                            subject_name: app.LABELS_BY_SUBJECT[self.subject_fullname][0]
                            card_icon: app.LABELS_BY_SUBJECT[self.subject_fullname][1]
                            on_press: self.load_text_list_by_subject(self.subject_fullname)
                    
                        SubjectCard:
                            subject_fullname: "Địa lý"
                            subject_name: app.LABELS_BY_SUBJECT[self.subject_fullname][0]
                            card_icon: app.LABELS_BY_SUBJECT[self.subject_fullname][1]
                            on_press: self.load_text_list_by_subject(self.subject_fullname)
                    
                        SubjectCard:
                            subject_fullname: "Kinh tế và Pháp luật"
                            subject_name: app.LABELS_BY_SUBJECT[self.subject_fullname][0]
                            card_icon: app.LABELS_BY_SUBJECT[self.subject_fullname][1]
                            on_press: self.load_text_list_by_subject(self.subject_fullname)
                    
                        SubjectCard:
                            subject_fullname: "Vật lý"
                            subject_name: app.LABELS_BY_SUBJECT[self.subject_fullname][0]
                            card_icon: app.LABELS_BY_SUBJECT[self.subject_fullname][1]
                            on_press: self.load_text_list_by_subject(self.subject_fullname)
                    
                        SubjectCard:
                            subject_fullname: "Hoá học"
                            subject_name: app.LABELS_BY_SUBJECT[self.subject_fullname][0]
                            card_icon: app.LABELS_BY_SUBJECT[self.subject_fullname][1]
                            on_press: self.load_text_list_by_subject(self.subject_fullname)
                    
                        SubjectCard:
                            subject_fullname: "Sinh học"
                            subject_name: app.LABELS_BY_SUBJECT[self.subject_fullname][0]
                            card_icon: app.LABELS_BY_SUBJECT[self.subject_fullname][1]
                            on_press: self.load_text_list_by_subject(self.subject_fullname)
                    
                        SubjectCard:
                            subject_fullname: "Công nghệ"
                            subject_name: app.LABELS_BY_SUBJECT[self.subject_fullname][0]
                            card_icon: app.LABELS_BY_SUBJECT[self.subject_fullname][1]
                            on_press: self.load_text_list_by_subject(self.subject_fullname)
                    
                        SubjectCard:
                            subject_fullname: "Tin học"
                            subject_name: app.LABELS_BY_SUBJECT[self.subject_fullname][0]
                            card_icon: app.LABELS_BY_SUBJECT[self.subject_fullname][1]
                            on_press: self.load_text_list_by_subject(self.subject_fullname)

                        SubjectCard:
                            subject_fullname: "Khác"
                            subject_name: app.LABELS_BY_SUBJECT[self.subject_fullname][0]
                            card_icon: app.LABELS_BY_SUBJECT[self.subject_fullname][1] 
                            on_press: self.load_text_list_by_subject(self.subject_fullname)

            # bottom buttons
            BoxLayout:
                padding: 0, 0
                spacing: 20
                size_hint_y: None
                height: '48dp'

                Btn:
                    size_hint: 1, 1
                    on_press:
                        app.reload_screen(3)
                    md_bg_color: (56/255, 56/255, 56/255, 1)
                    line_color: 0, 0, 0, 0
                    text: 'Thêm tài liệu ôn tập'
                    font_size: '16sp'


                

<NewFile>:
    name: "NewFile"
    canvas.before:
        Color:
            rgba: (0.321, 0.298, 0.431, 1.000)
        Rectangle:
            pos: self.pos
            size: self.size
    on_leave:
        app.reload_screen(2)
    on_enter:
        textfield.text = ''
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            padding: 15, 20, 30, 20
            orientation: "vertical"
            spacing: 30
            size_hint_y: 0.1
            MDLabel:
                text: "Tạo ngữ liệu mới"
                
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                font_size: '22sp'
                halign: 'left'
                color: 1, 1, 1, 1
        
        MDCard:
            orientation: 'vertical'
            elevation: 2.5
            shadow_softness: 12
            size_hint_y: 1
            radius: 15
            padding: 15, 30
            spacing: 10

            MDLabel:
                text: "Tải tài liệu lên"
                size_hint_y: 0.04

            GridLayout:
                id: btn_holder
                size_hint_y: 0.2
                cols: 2
                spacing: 20
                orientation: 'lr-tb'
                MDCard:
                    id: capture_btn
                    elevation: 1.4
                    shadow_softness: 12
                    padding: 0, 5, 0, 5
                    default_size_hint: 0.5, None
                    on_press:
                        root.capture()
                    MDLabel:
                        text: u'📷'
                        halign: "center"
                        font_name: "UI/Fonts/seguiemj.ttf"
                        valign: 'center'
                        font_size: '28sp'
                        size_hint_x: None
                        width: self.height
                    MDLabel:
                        text: "Quét tài liệu"
                        halign: "center"
                        font_size: '16sp'
                MDCard:
                    id: browse_file_btn
                    elevation: 1.4
                    shadow_softness: 12
                    padding: 0, 5, 0, 5
                    default_size_hint: 0.5, None
                    on_press:
                        root.open_from_file()
                    MDLabel:
                        text: u'📂'
                        halign: "center"
                        font_name: "UI/Fonts/seguiemj.ttf"
                        valign: 'center'
                        font_size: '28sp'
                        size_hint_x: None
                        width: self.height
                    MDLabel:
                        text: "Chọn file"
                        halign: "center"
                        font_size: '16sp'
            
            MDLabel:
                text: " "
                size_hint_y: 0.04

            MDTextField:
                size_hint_x: 1
                id: name
                multiline: False
                mode: 'rectangle'
                text_color_normal: 0, 0, 0, 1
                hint_text: 'Tên'
            
            MDTextField:
                id: textfield
                size_hint_y: 1.2
                multiline: True
                mode: 'rectangle'
                text_color_normal: 0, 0, 0, 1
                hint_text: 'Nhập nội dung'
                    
            Btn:
                md_bg_color:(0.321, 0.298, 0.431, 1.000)
                line_color: 0,0,0,0

                size_hint_x: 1
                text: "Tải lên"
                id: upload_btn
                on_release:
                    root.upload_file()

<TextBrowser>:

    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 0, 0, 0, 0
        canvas.before:
            Color:
                rgba: (231/255, 234/255, 255/255, 1)
            Rectangle:
                pos: self.pos
                size: self.size
        
        MDCard:
            orientation: "vertical"
            padding: 10, 10, 10, 10
            elevation: 2.5
            shadow_softness: 12
            size_hint_y: 1
            spacing: 20
            
            # Title bar
            MDCard:
                size_hint_y: 0.17
                spacing: 12
                padding: 5,5,5,5
                
                # subject icon
                MDCard:
                    elevation: 1.9
                    shadow_softness: 12
                    size_hint_x: None
                    width: self.height
                    radius: 5

                    MDLabel:
                        id: subject_icon
                        font_name: "UI/Fonts/seguiemj.ttf"
                        font_size: '33sp'
                        valign: "center"
                        halign: "center"

                # subject title
                BoxLayout:
                    orientation: "vertical"
                    spacing: 10
                    padding: 0, 5, 0, 5
                    MDLabel:
                        size_hint_y: 0.3
                        id: subject
                        bold: False
                        color: (56/255, 56/255, 56/255, 0.7)
                        font_size: '15sp'
                        
                    MDLabel:
                        id: text_name
                        font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                        font_size: '24sp'
                        color: (56/255, 56/255, 56/255, 1)
                        size_hint_y: 0.5

            MDCard:
                elevation: 2
                shadow_softness: 12
                orientation: 'vertical'
                padding: 15, 20, 15, 20
                size_hint_y: None
                height: "98dp"
                spacing: 10
                md_bg_color: (238/255, 249/255, 255/255, 1)
                line_color: (33/255, 150/255, 243/255)
                
                #Keywords area
                BoxLayout:
                    spacing: 5
                    size_hint_y: 0.1
                    padding: 0, 0, 0, 10
                    MDLabel:
                        
                        size_hint_y: 0.07
                        size_hint_x: None
                        width: '34sp'
                        text: u'🔑'
                        font_name: 'UI/Fonts/seguiemj.ttf'
                        font_size: '18sp'
                        valign: 'top'
                        halign: 'center'
                    MDLabel:
                        text: "Từ khóa"
                        font_size: '16sp'
                        halign: "left"
                        valign: "top"
                        bold: False
                        color: (56/255, 56/255, 56/255, 1)
                        size_hint_y: 0.1
                        size_hint_x: 0.8
                        padding: 0, 0
                KeywordsView:
                    id: keywordsview
                    text_name: root.text_name
                    
                    size_hint_y: 0.3
            
            MDCard:
                orientation: "vertical"
                padding: 15, 15, 15, 15
                spacing: 0
                size_hint_y: 1
                elevation: 2
                shadow_softness: 12
                #Content area
                BoxLayout:
                    spacing: 5
                    size_hint_y: 0.1

                    MDLabel:
                        size_hint_x: None
                        size_hint_y: 1
                        width: '34sp'
                        text: u'📄'
                        font_name: 'UI/Fonts/seguiemj.ttf'
                        font_size: '18sp'
                        valign: 'top'
                        halign: 'center'
                    MDLabel:
                        text: "Nội dung"
                        font_size: '16sp'
                        halign: "left"
                        valign: "top"
                        bold: False
                        color: (56/255, 56/255, 56/255, 1)
                        size_hint_x: 0.8
                        padding: 0, 0

                
                MDLabel:
                    font_size: '16sp'
                    mode: 'rectangle'
                    padding: (0, 0, 0, 15)
                    id: content_box
                    text_color_normal: 0, 0, 0, 1
                    color_mode: 'custom'
                    line_color: 1, 1, 1, 1
                    #mode: 'rectangle'
                    multiline: True
                    size_hint_y: 0.9
                    valign: "top"
                    font_name: "UI/Fonts/WorkSans-Italic.ttf"
            
            # Quiz configuration panel
            MDBoxLayout:
                orientation: "vertical"
                spacing: 10
                size_hint_y: 0.25

                # customization options
                GridLayout:
                    cols: 3
                    orientation: 'lr-tb'
                    spacing: 5
                    size_hint_y: 0.45
                    
                    MDFillRoundFlatButton:
                        md_bg_color: 0,0,0,0
                        font_name: "UI/Fonts/seguiemj.ttf"
                        font_size: '21sp'
                        on_press: root.change_qs_num(-1)
                        text: '➖'
                        size_hint_x: None
                        width: '24dp'

                    MDRoundFlatButton:
                        line_color: (0,0,0,0.4)
                        font_name: "UI/Fonts/WorkSans-SemiBold.ttf"
                        # text_color: 56/255, 56/255, 56/255
                        id: qs_num_disp
                        size_hint_x: 1
                        font_size: '17dp'

                    MDFillRoundFlatButton:
                        md_bg_color: 0,0,0,0
                        font_name: "UI/Fonts/seguiemj.ttf"
                        font_size: '21sp'
                        on_press: root.change_qs_num(1)
                        text: '➕'
                        size_hint_x: None
                        width: '24dp'

                MDCard:
                    #orientation: "vertical"
                    elevation: 2
                    shadow_softness: 12
                    padding: 5, 0, 5, 0
                    size_hint_y: 0.5
                    spacing: 0
                    radius: 10
                    md_bg_color: (56/255, 56/255, 56/255, 1)
                    on_press:
                        root.prepare_questionaire()
                    MDLabel:
                        text: u'📝'
                        halign: 'center'
                        font_name: "UI/Fonts/seguiemj.ttf"
                        valign: 'center'
                        font_size: '30sp'
                        text_color: 1, 1, 1,1
                        size_hint_x: 0.15
                    MDLabel:
                        text: "Làm bài tập"
                        halign: "center"
                        font_size: '18sp'
                        
                        font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                        color: 1, 1, 1, 1
<GoalSetter>:
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 0, 20, 0, 0
        canvas.before:
            Color:
                # rgba: (196/255, 143/255, 255/255, 1)
            Rectangle:
                pos: self.pos
                size: self.size
        BoxLayout:
            size_hint_y: 0.1
            padding: 15, 0, 10, 0

            MDLabel:
                text: 'Đặt mục tiêu hằng ngày'
                font_size: '22sp'
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                size_hint_x: 0.8
                color: 56/255, 56/255, 56/255
        MDCard:
            size_hint_x: 1
            radius: 15

            orientation: 'vertical'
            padding: 15, 0, 15, 15
            spacing: 15

            DaysOfWeekView:
                id: dowview
                size_hint_y: 0.1
            MDCard:
                elevation: 2.6
                shadow_softness: 12
                orientation: 'vertical'
                padding: 10, 10, 10, 10
                spacing: 10
                size_hint_y: 0.9
                MDGridLayout:
                    cols: 1
                    rows: 4
                    orientation: 'lr-tb'
                    spacing: 15
                    MDLabel:
                        text: 'Số lượt ôn tập'
                        font_size: '16sp'
                        size_hint_y: 0.1

                    MDBoxLayout:
                        spacing: 15
                        size_hint_y: 0.1
                        Btn:
                            line_color: 0,0,0,0
                            md_bg_color: (255/255, 188/255, 30/255)
                            font_name: 'UI/Fonts/seguiemj.ttf'
                            id: minus_btn
                            text: '➖'
                            on_release:
                                root.change_qs_num(-1)
                        MDRectangleFlatButton:
                            size_hint_x: 0.6
                            text: '5'
                            text_color: (160/255, 112/255, 0)
                            id: goal_count_disp
                            line_color: 'grey'
                            font_size: '18sp'
                            font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                            
                        Btn:

                            line_color: 0,0,0,0
                            md_bg_color: (255/255, 188/255, 30/255)
                            id: plus_btn
                            font_name: 'UI/Fonts/seguiemj.ttf'
                            text: '➕'
                            on_release:
                                root.change_qs_num(1)

                    BoxLayout:
                        orientation: "vertical"
                        padding:0,10,0,0
                        MDLabel:
                            text: 'Chọn một / nhiều chủ đề ôn tập'
                            font_size: '16sp'
                            size_hint_y: 0.1
                        SubjectChooserList:
                            size_hint_y: 0.8
                            id: subjectchooserlist

                Btn:
                    size_hint_x: 1.0
                    md_bg_color: (255/255, 188/255, 30/255)
                    text: 'Lưu'
                    text_color: (56/255, 56/255, 56/255)
                    line_color: (56/255, 56/255, 56/255)
                    on_release: 
                        root.save_goals()
            
<MCQPage>:
    MDBoxLayout:
        orientation: 'vertical'
        MDCard:
            md_bg_color: (0.321, 0.298, 0.431, 1.000)
            radius: 0, 0, 15, 15
            padding: 10, 10, 10, 10
            orientation: 'vertical'
            size_hint_y: 0.6
            spacing: 5
            MDBoxLayout:
                size_hint_y: 0.07
                MDTextButton:
                    font_name: 'UI/Fonts/seguiemj.ttf'
                    id: exit_to_homescreen 
                    text: u'◀️'
                    font_size: '24sp'
                    size_hint_x: 0.15
                    valign: 'center'
                    on_release:
                        app.reload_screen(2)
                MDProgressBar:
                    id: progressbar
                    color: (0.55, 0.76, 0.29, 1)

            MDLabel:
                id: qs_num
                text: "#️⃣ CÂU 1/10"
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                color: 1,1,1,0.8
                font_size: '21sp'
                
                size_hint_y: 0.07
                valign: 'top'

            MDLabel:
                id: prompt
                text: "✒️ ĐIỀN VÀO CHỖ TRỐNG"
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                color: 1,1,1,0.8
                font_size: '21sp'
                
                size_hint_y: 0.07
                valign: 'top'
            MDLabel:
                id: problem
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                font_size: '25sp'
                color: 1,1,1,1
                
                size_hint_y: 1 - 0.1 * 2 - 0.07
        MDGridLayout:
            size_hint_y: 0.4
            padding:10, 30, 10, 10
            spacing: 15
            rows: 2
            MDRectangleFlatButton:
                id: answers_dropdown
                text: "--Chọn đáp án--"
                line_color: 'grey'
                valign: 'center'
                text_color: (0.321, 0.298, 0.431, 1.000)
                size_hint_x: 1.0
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                
            
            MDFillRoundFlatButton:
                id: submit
                text: "Xác nhận"
                size_hint_x: 1.0
                md_bg_color: (56/255, 56/255, 56/255, 1)
                
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'

<ShortAnswerPage>:
    MDBoxLayout:
        orientation: 'vertical'
        MDCard:
            id: question_panel
            md_bg_color: (0.321, 0.298, 0.431, 1.000)
            radius: 0, 0, 15, 15
            padding: 10, 10, 10, 10
            orientation: 'vertical'
            size_hint_y: 0.6
            spacing: 5
            MDBoxLayout:
                size_hint_y: 0.07
                MDTextButton:
                    id: exit_to_homescreen
                    font_name: 'UI/Fonts/seguiemj.ttf'
                    text: u'◀️'
                    font_size: '22sp'
                    size_hint_x: 0.15
                    valign: 'center'
                    on_release:
                        app.reload_screen(2)
                MDProgressBar:
                    id: progressbar
                    color: (0.55, 0.76, 0.29, 1)

            MDLabel:
                id: qs_num
                text: "#️⃣ CÂU 1/10"
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                color: 1,1,1,0.8
                font_size: '16sp'
                
                size_hint_y: 0.07
                valign: 'top'

            MDLabel:
                id: prompt
                text: "✒️ ĐIỀN VÀO CHỖ TRỐNG"
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                color: 1,1,1,0.8
                font_size: '16sp'
                
                size_hint_y: 0.07
                valign: 'top'
            MDLabel:
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                font_size: '22sp'
                text: root.problem
                color: 1,1,1,1
                
                size_hint_y: 1 - 0.1 * 3 - 0.07

            MDLabel:
                id: validation_result
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                color: 1, 1, 1, 1
                font_size: '16sp'
                
                size_hint_y: 0.07
                valign: 'top'

        MDGridLayout:
            size_hint_y: 0.4
            padding:10, 30, 10, 10
            spacing: 15
            rows: 4
            MDTextField:
                id: ans_input_1
                hint_text: "Đáp án 1"
                valign: 'center'
                text_color_normal: (0.321, 0.298, 0.431, 1.000)
                size_hint_x: 1.0
                
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'

            MDTextField:
                id: ans_input_2
                hint_text: "Đáp án 2"
                valign: 'center'
                text_color_normal: (0.321, 0.298, 0.431, 1.000)
                size_hint_x: 1.0
                
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'

            MDTextField:
                id: ans_input_3
                hint_text: "Đáp án 3"
                valign: 'center'
                text_color_normal: (0.321, 0.298, 0.431, 1.000)
                size_hint_x: 1.0
                
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'
            
            MDFillRoundFlatButton:
                id: submit
                text: "Xác nhận"
                size_hint_x: 1.0
                md_bg_color: (56/255, 56/255, 56/255, 1)
                
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                font_size: '18sp'
                on_press:
                    root.submit()

<MatchingPage>:
    MDBoxLayout:
        orientation: 'vertical'
        spacing: 10
        padding: 0, 0, 0, 10 
        MDCard:
            id: question_panel
            md_bg_color: (0.321, 0.298, 0.431, 1.000)
            radius: 0, 0, 15, 15
            padding: 10, 10, 10, 10
            orientation: 'vertical'
            size_hint_y: 0.6
            spacing: 5
            MDBoxLayout:
                size_hint_y: 0.07
                MDTextButton:
                    id: exit_to_homescreen
                    font_name: 'UI/Fonts/seguiemj.ttf'
                    text: u'◀️'
                    font_size: '22sp'
                    size_hint_x: 0.15
                    valign: 'center'
                    on_release:
                        app.reload_screen(2)
                MDProgressBar:
                    id: progressbar
                    color: (0.55, 0.76, 0.29, 1)

            MDLabel:
                id: qs_num
                text: "#️⃣ CÂU 1/10"
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                color: 1,1,1,0.8
                font_size: '16sp'
                
                size_hint_y: 0.07
                valign: 'top'


            MDLabel:
                id: prompt
                text: "✒️ SẮP XẾP CÁC TỪ THEO THỨ TỰ"
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                color: 1,1,1,0.8
                font_size: '16sp'
                
                size_hint_y: 0.07
                valign: 'top'
            MDLabel:
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                font_size: '23sp'
                text: root.problem
                color: 1,1,1,1
                
                size_hint_y: 1 - 0.1 * 3 - 0.07

            MDLabel:
                id: validation_result
                font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                color: 1, 1, 1, 1
                font_size: '16sp'
                
                size_hint_y: 0.07
                valign: 'top'
        
        ScrollView:
            size_hint_y: 0.4
            MDGridLayout:
                id: gridlayout
                orientation: 'lr-tb'
                rows: 5
                size_hint_y: 1.3
                size_hint_x: 1
                spacing: 10
                padding: 10, 0

        MDFillRoundFlatButton:
            id: submit
            text: "Xác nhận"
            size_hint_x: 1.0
            md_bg_color: (56/255, 56/255, 56/255, 1)
            
            font_name: 'UI/Fonts/WorkSans-Bold.ttf'
            font_size: '16sp'
            on_press:
                root.submit()

<ResultPage>:
    id: result
    md_bg_color: (0.321, 0.298, 0.431, 1.000)
    MDBoxLayout:
        padding: 10
        spacing: 10
        orientation: 'vertical'
        MDLabel:
            
            id: r_title
            halign: 'center'
            font_name: 'UI/Fonts/WorkSans-Bold.ttf'
            color: 1,1,1,1
            font_size: '24sp'
            
            size_hint_y: 0.07
            valign: 'center'

        MDLabel:
            id: r_metrics
            text: "20 câu · 15 ✔️ · 5 ❌".upper()
            halign: 'center'
            font_name: 'UI/Fonts/WorkSans-Bold.ttf'
            color: 1,1,1,0.8
            font_size: '16sp'
            
            size_hint_y: 0.07
            valign: 'center'

        MDBoxLayout:
            size_hint_y: 0.55
            canvas.before:
                Color:
                    rgba: (0.321 * 0.75, 0.298 * 0.75, 0.431 * 0.75, 1.000)
                Ellipse:
                    pos: root.center_x - (root.height * 0.15), root.center_y - (root.height * 0.01)
                    size: (root.height * 0.3), (root.height * 0.3)
                    angle_start: 0
                    angle_end: 360

                Color:
                    rgba: root.r_gauge_color
                Ellipse:
                    
                    pos: root.center_x - (root.height * 0.15), root.center_y - root.height * 0.01
                    size: (root.height * 0.3), (root.height * 0.3)
                    angle_start: 0
                    angle_end: root.r_percentage_gauge
            MDBoxLayout:
                size_hint_y: 0.9
                canvas.before:
                    Color:
                        rgba: (0.321, 0.298, 0.431, 1.000)
                    Ellipse:
                        pos: root.center_x - (root.height * 0.12), root.center_y + (root.height * 0.02)
                        size: (root.height * 0.24), (root.height * 0.24)
                        angle_start: 0
                        angle_end: 360
                MDLabel:
                    id: r_percentage
                    halign: "center"
                    font_name: 'UI/Fonts/WorkSans-Bold.ttf'
                    color: 1, 1, 1, 1
                    font_size: '36sp'
                    
                    valign: 'center'
                    halign: 'center'

        MDCard:
            size_hint_y: 0.55
            md_bg_color: (0.321 * 0.75, 0.298 * 0.75, 0.431 * 0.75, 1.000)
            elevation: 2.3
            shadow_softness: 12
            ScrollView:
                do_scroll_x: True
                DetailedResultList:
                    id: detailedresultlist

        Btn:
            text: 'Tiếp tục'
            size_hint_x: 1
            on_release: app.reload_screen(2)


# KNOWN ISSUES
## Lỗi kết nối SQL khi không tương tác trong thời gian dài (khắc phục bằng cách vào lại app)
## Thời gian tạo bài tập lâu (do tốc độ phản hồi của OpenAI API)